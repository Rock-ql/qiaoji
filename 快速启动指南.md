# ExpenseTracker 快速启动指南

## 🎯 第一步：检查环境

在开始之前，请确认：

```bash
# 1. 检查macOS版本（需要14.0+）
sw_vers

# 2. 检查Xcode版本（需要16.0+）
xcodebuild -version

# 3. 如果没有Xcode，从App Store下载
# 搜索 "Xcode" 并安装（约15GB）
```

## 🚀 第二步：创建Xcode项目

### 方法A：通过Xcode创建（推荐新手）

1. **打开Xcode**
   - 在应用程序中找到Xcode并打开
   - 或在终端运行：`open -a Xcode`

2. **创建新项目**
   - 点击 `Create New Project`
   - 或选择 `File` -> `New` -> `Project`

3. **选择模板**
   - 平台：选择 **iOS**
   - 模板：选择 **App**
   - 点击 `Next`

4. **配置项目信息**
   ```
   Product Name: ExpenseTracker
   Team: 选择你的开发团队（如果没有，选择"Add Account"）
   Organization Identifier: com.yourname
   Bundle Identifier: com.yourname.ExpenseTracker
   Interface: SwiftUI ⚠️ 重要
   Storage: SwiftData ⚠️ 重要
   Language: Swift
   Include Tests: 可选
   ```
   - 点击 `Next`

5. **选择保存位置**
   - 建议选择一个新文件夹（如 `~/Documents/iOS-Projects/`）
   - **不要**选择当前的 `qiaoji` 文件夹
   - 点击 `Create`

### 方法B：在当前目录创建

```bash
# 在终端中执行
cd /Users/rockcoder/IdeaProjects/ai-project/qiaoji

# 创建Xcode项目文件夹
mkdir -p ExpenseTrackerProject
cd ExpenseTrackerProject

# 然后在Xcode中创建项目，选择这个文件夹
```

## 📁 第三步：导入源代码文件

### 1. 删除自动生成的文件

在Xcode左侧的项目导航器中：
- 找到并删除 `ContentView.swift`
- 找到并删除 `Item.swift`（如果有）
- 右键选择 `Move to Trash`

### 2. 导入ExpenseTracker文件夹

**重要：使用拖拽方式导入**

1. **在Finder中打开源码文件夹**
   ```bash
   # 在终端运行，打开源代码所在目录
   open /Users/rockcoder/IdeaProjects/ai-project/qiaoji/ExpenseTracker
   ```

2. **拖拽到Xcode**
   - 将Finder中的整个 `ExpenseTracker` 文件夹
   - 拖拽到Xcode左侧项目导航器的 `ExpenseTracker` 项目节点上
   - **不要松手！**看到蓝色高亮后才松手

3. **配置导入选项**
   在弹出的对话框中：
   - ✅ **勾选** `Copy items if needed` （重要！复制文件而不是引用）
   - ✅ **选择** `Create groups`（不要选Create folder references）
   - ✅ **确保** `Add to targets` 中勾选了 `ExpenseTracker`
   - 点击 `Finish`

### 3. 验证文件结构

导入成功后，左侧应显示：
```
ExpenseTracker (项目)
├── ExpenseTracker (文件夹 - 黄色)
│   ├── App (文件夹)
│   │   ├── ExpenseTrackerApp.swift
│   │   └── ContentView.swift
│   ├── Features (文件夹)
│   │   ├── Transactions
│   │   │   └── Models
│   │   │       └── Transaction.swift
│   │   ├── Budget
│   │   │   └── Models
│   │   │       └── Budget.swift
│   │   └── Settings
│   │       └── Models
│   │           ├── Category.swift
│   │           └── Account.swift
│   ├── Core
│   ├── Shared
│   └── Resources
├── Assets.xcassets (保留)
└── ExpenseTrackerApp.swift (可能重复，见下方处理)
```

## 🔧 第四步：修复应用入口

### 情况A：有两个ExpenseTrackerApp.swift

如果看到两个同名文件：

1. **检查哪个有 @main 标记**
   - 打开项目根目录的 `ExpenseTrackerApp.swift`
   - 打开 `ExpenseTracker/App/ExpenseTrackerApp.swift`

2. **删除根目录的文件**
   - 删除项目根目录下的 `ExpenseTrackerApp.swift`
   - 保留 `ExpenseTracker/App/ExpenseTrackerApp.swift`

3. **确保 @main 存在**
   - 打开保留的文件
   - 确认第一行有 `@main` 标记

### 情况B：只有一个文件

- 打开文件，确认包含 `@main struct ExpenseTrackerApp: App`
- 如果没有完整内容，从我们的源码复制

## ⚙️ 第五步：配置项目设置

### 1. 设置部署目标

1. 点击左侧最顶部的项目名称（蓝色图标）
2. 在中间区域选择 `TARGETS` -> `ExpenseTracker`
3. 在 `General` 标签页中
4. 找到 `Minimum Deployments`
5. 将 iOS 版本改为 **17.0**

### 2. 配置签名

1. 选择 `Signing & Capabilities` 标签页
2. ✅ 确保 `Automatically manage signing` 已勾选
3. `Team` 下拉框：
   - 如果有团队，选择你的团队
   - 如果没有，点击 `Add Account` 添加Apple ID

### 3. 添加iCloud功能

1. 在 `Signing & Capabilities` 标签页
2. 点击 `+ Capability` 按钮
3. 搜索 `iCloud`
4. 双击添加
5. ✅ 勾选 `CloudKit`
6. 在 `Containers` 区域：
   - 如果显示错误，点击右侧的 `+` 按钮
   - 选择 `Use default container`
   - 或输入自定义名称：`iCloud.com.yourname.ExpenseTracker`

### 4. 修改CloudKit配置（重要！）

1. 打开 `ExpenseTracker/App/ExpenseTrackerApp.swift`
2. 找到这一行：
   ```swift
   cloudKitDatabase: .private("iCloud.com.expensetracker.app")
   ```
3. 修改为你的Bundle Identifier对应的容器ID：
   ```swift
   cloudKitDatabase: .private("iCloud.com.yourname.ExpenseTracker")
   ```
   或者临时禁用iCloud：
   ```swift
   cloudKitDatabase: .none  // 禁用iCloud，仅使用本地数据库
   ```

## 🎮 第六步：编译和运行

### 1. 选择模拟器

1. 在Xcode顶部工具栏
2. 找到设备选择器（显示 "ExpenseTracker > 设备名"）
3. 点击选择：
   - `iPhone 15 Pro` （推荐）
   - 或 `iPhone 15`
   - 或任何iOS 17+的模拟器

### 2. 编译项目

按 `Command + B` 或点击菜单 `Product` -> `Build`

**第一次编译会较慢（1-2分钟），请耐心等待**

### 3. 检查编译错误

如果有错误，常见问题：

**错误1：Cannot find 'Transaction' in scope**
- 原因：文件未正确导入
- 解决：确认所有 .swift 文件都在项目中（左侧能看到）

**错误2：Type 'Transaction' has no member 'transactions'**
- 原因：SwiftData宏未生效
- 解决：Clean Build Folder (Shift + Command + K)，然后重新编译

**错误3：CloudKit错误**
- 解决：按上面"第五步-4"修改配置，使用 `.none` 禁用iCloud

### 4. 运行应用

1. 按 `Command + R`
2. 或点击左上角的播放按钮 ▶️
3. 等待模拟器启动（首次启动较慢）

## ✅ 第七步：验证运行

应用启动后，你应该看到：

1. **底部Tab栏**：交易、统计、预算、设置
2. **空白交易列表**：显示"暂无交易记录"
3. **浮动+按钮**：蓝色渐变圆形按钮

### 测试添加交易

1. 点击浮动的 `+` 按钮
2. 选择"支出"
3. 输入金额，如 `100`
4. 选择分类，如"餐饮"🍴
5. 点击右上角"保存"
6. 返回列表，应该能看到新添加的交易

## 🐛 常见问题排查

### 问题1：编译失败 - 找不到SwiftData

```
解决方案：
1. 确认部署目标是 iOS 17.0
2. 重启Xcode
3. Product -> Clean Build Folder
4. 重新编译
```

### 问题2：应用崩溃 - ModelContainer初始化失败

```
原因：CloudKit配置错误
解决：
1. 打开 ExpenseTrackerApp.swift
2. 修改配置为：
   configurations: ModelConfiguration(
       cloudKitDatabase: .none
   )
```

### 问题3：看不到默认分类

```
原因：异步初始化未完成
解决：
1. 关闭应用
2. 在模拟器中删除应用
3. 重新运行 (Command + R)
```

### 问题4：模拟器无法启动

```
解决：
1. 在Xcode顶部选择其他模拟器
2. 或 Window -> Devices and Simulators -> 添加新模拟器
```

### 问题5：签名错误

```
错误信息："Signing for ExpenseTracker requires a development team"

解决：
1. Xcode -> Preferences (Command + ,)
2. Accounts 标签页
3. 点击 + 添加你的Apple ID
4. 回到项目设置，选择这个Team
```

## 📱 在真机上运行

### 1. 连接iPhone

- 使用USB线连接Mac和iPhone
- 在iPhone上点击"信任此电脑"

### 2. 选择设备

- 在Xcode顶部设备选择器中选择你的iPhone

### 3. 配置证书（首次需要）

- Xcode会自动处理证书
- 在iPhone上：Settings -> General -> VPN & Device Management
- 找到你的开发者证书，点击"信任"

### 4. 运行

- Command + R 运行
- 首次安装会慢一些

## 🎯 成功标志

如果你看到以下内容，说明运行成功：

- ✅ 模拟器成功启动
- ✅ 应用图标显示
- ✅ 底部有4个Tab
- ✅ 点击+按钮能打开添加交易页面
- ✅ 能看到12个默认分类（餐饮、交通等）
- ✅ 能成功添加并显示交易记录

## 📚 下一步

应用运行成功后：

1. 查看 `README.md` 了解功能详情
2. 查看 `XCODE_SETUP_GUIDE.md` 了解高级配置
3. 开始开发新功能
4. 学习Swift和SwiftUI

## 💡 快速命令参考

```bash
# 编译项目
Command + B

# 运行项目
Command + R

# 停止运行
Command + .

# 清理构建
Shift + Command + K

# 重启Xcode
Command + Q，然后重新打开

# 打开模拟器设置
Command + Shift + 2
```

## 🆘 需要帮助？

如果遇到问题：

1. 检查Xcode版本是否 16.0+
2. 检查macOS版本是否 14.0+
3. 尝试重启Xcode
4. 尝试清理构建 (Shift + Command + K)
5. 查看Xcode控制台的错误信息（底部面板）

---

**祝你运行成功！🎉** 如有问题，欢迎查看详细文档或提出反馈。
