# 分类管理功能说明

## 📅 开发时间
2025-11-13

## 🎯 功能概述
实现了完整的分类管理功能，用户可以查看、添加、编辑、删除和排序自定义收入/支出分类。

---

## ✨ 核心功能

### 1. 分类列表查看
- 按收入/支出分组显示
- 显示分类图标、名称、交易笔数、总金额
- 系统分类带锁图标标识
- 支持拖拽排序

### 2. 添加分类
- 选择分类类型（收入/支出）
- 输入分类名称
- 从50+图标中选择
- 从50种预设颜色中选择
- 实时预览效果

### 3. 编辑分类
- 修改分类名称（系统分类除外）
- 更换图标和颜色
- 查看统计信息
- 删除分类（带关联检查）

### 4. 删除保护
- 系统预设分类不可删除
- 有交易记录的分类提示处理
- 二次确认对话框

### 5. 排序功能
- 支持拖拽调整分类顺序
- 按收入/支出分组排序
- 自动保存排序结果

---

## 📁 文件结构

### 新增文件（6个）
```
Features/Settings/Views/
├── CategoryManagementView.swift  # 分类管理主界面
├── CategoryListRow.swift         # 分类列表行组件
├── AddCategoryView.swift         # 添加分类界面
├── EditCategoryView.swift        # 编辑分类界面
├── IconPickerView.swift          # 图标选择器（50+图标）
└── ColorPickerView.swift         # 颜色选择器（50种颜色）
```

### 修改文件（1个）
```
App/ContentView.swift
├── 连接设置页面导航（第345行）
└── 优化默认分类初始化（第87-105行）
```

---

## 🎨 UI/UX 设计

### 主界面
- **导航栏**：标题 + 添加按钮 + 编辑按钮
- **列表分组**：支出分类 / 收入分类
- **列表行**：图标圆圈 + 名称 + 统计信息 + 箭头
- **交互**：点击编辑 / 左滑删除 / 拖拽排序

### 添加/编辑界面
- **表单布局**：Form 风格
- **类型选择**：Segmented Control（添加时）
- **名称输入**：TextField（系统分类禁用）
- **图标/颜色**：点击弹出选择器
- **统计信息**：只读显示（编辑时）
- **删除按钮**：底部危险操作区（编辑时）

### 图标选择器
- **网格布局**：自适应列数
- **图标分类**：餐饮、交通、购物等
- **实时预览**：选中状态高亮
- **总数**：50+个SF Symbols

### 颜色选择器
- **网格布局**：自适应列数
- **预设颜色**：50种常用颜色
- **实时预览**：选中颜色带白色边框
- **色系**：红、橙、黄、绿、青、蓝、紫、粉、灰、棕

---

## 💡 技术实现

### 数据管理
```swift
// 使用 SwiftData 查询
@Query(sort: \Category.sortOrder) var categories: [Category]
@Environment(\.modelContext) private var modelContext

// CRUD 操作
modelContext.insert(newCategory)  // 创建
category.name = newName           // 更新
modelContext.delete(category)     // 删除
try? modelContext.save()          // 保存
```

### 系统分类保护
```swift
// 默认分类标记为系统分类
Category(name: "餐饮", icon: "fork.knife", color: "FF6B6B",
         type: .expense, isSystem: true, sortOrder: 0)

// 系统分类限制
if category.isSystem {
    // 不可删除
    // 名称不可修改
}
```

### 删除验证
```swift
// 检查关联交易
if category.transactionCount > 0 {
    showAlert("该分类下有交易记录")
    return
}
```

### 拖拽排序
```swift
.onMove { source, destination in
    moveCategory(from: source, to: destination, in: type)
}

// 更新 sortOrder
for (index, category) in updatedList.enumerated() {
    category.sortOrder = baseOrder + index
}
```

---

## 🚀 使用方法

### 查看分类列表
1. 打开应用 → 设置标签页
2. 点击「分类管理」
3. 查看所有分类（按收入/支出分组）

### 添加新分类
1. 点击右上角「+」按钮
2. 选择分类类型（收入/支出）
3. 输入分类名称
4. 点击图标 → 选择图标
5. 点击颜色 → 选择颜色
6. 点击「保存」

### 编辑分类
1. 在分类列表中点击某个分类
2. 修改名称、图标或颜色
3. 查看统计信息
4. 点击「保存」

### 删除分类
1. 方式一：左滑分类行 → 点击删除
2. 方式二：进入编辑界面 → 点击底部删除按钮
3. 确认删除对话框
4. 注意：系统分类和有交易的分类不可删除

### 排序分类
1. 点击右上角「编辑」按钮
2. 拖动分类行右侧的把手
3. 调整到目标位置
4. 点击「完成」保存

---

## ⚠️ 注意事项

### 1. 系统分类
- **标识**：锁图标
- **限制**：不可删除、名称不可修改
- **默认**：8个支出分类 + 4个收入分类

### 2. 删除限制
- 系统分类不可删除
- 有交易记录的分类需先处理交易
- 删除操作不可撤销

### 3. 排序规则
- 支出分类独立排序（sortOrder: 0-n）
- 收入分类独立排序（sortOrder: n+1 - m）
- 拖拽排序实时保存

### 4. 名称规范
- 建议使用简短易懂的名称
- 2-6个汉字最佳
- 避免重复名称

---

## 📊 数据统计

### 文件统计
- 新增Swift文件：6个
- 修改Swift文件：1个
- 总代码行数：约600行
- 注释覆盖率：>30%

### 功能统计
- 预设图标：50+个
- 预设颜色：50种
- 默认分类：12个（8支出+4收入）
- 功能模块：5个（列表/添加/编辑/图标/颜色）

---

## 🔄 后续优化建议

### Phase 2 增强功能
1. **搜索功能**：按名称搜索分类
2. **筛选功能**：按类型/使用频率筛选
3. **批量操作**：批量编辑、批量删除
4. **图标搜索**：图标选择器支持搜索
5. **自定义颜色**：支持色轮选择颜色

### Phase 3 高级功能
1. **分类统计**：使用率、趋势分析
2. **分类建议**：AI推荐常用分类
3. **导入导出**：备份/恢复分类配置
4. **分类合并**：合并重复分类
5. **分类分享**：分享到其他设备

---

## 🧪 测试清单

### 基础功能测试
- [ ] 查看分类列表
- [ ] 添加新分类
- [ ] 编辑分类信息
- [ ] 删除自定义分类
- [ ] 拖拽排序

### 边界测试
- [ ] 尝试删除系统分类（应被阻止）
- [ ] 尝试删除有交易的分类（应提示）
- [ ] 尝试修改系统分类名称（应被禁用）
- [ ] 添加超长名称分类
- [ ] 快速连续添加多个分类

### 集成测试
- [ ] 新分类在添加交易界面显示
- [ ] 编辑分类后交易列表更新
- [ ] 删除分类后相关数据处理
- [ ] 排序后在其他界面生效

---

## 📝 更新记录

### v1.0.0 (2025-11-13)
- ✅ 实现分类列表查看
- ✅ 实现添加分类功能
- ✅ 实现编辑分类功能
- ✅ 实现删除分类功能（带保护）
- ✅ 实现拖拽排序功能
- ✅ 创建图标选择器（50+图标）
- ✅ 创建颜色选择器（50种颜色）
- ✅ 优化默认分类初始化
- ✅ 系统分类保护机制

---

**作者：** xiaolei
**完成日期：** 2025-11-13
**代码规范：** 中文注释 + 作者标注
**iOS要求：** iOS 15.0+
